<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Delete Employee - LMS Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"/>
  <style>
    :root { --primary-color:#00d9ff; --primary-dark:#00b8d4; --background:#0f172a; --sidebar:#1e293b; --card:#1e293b; --text:#f8fafc; --muted:#94a3b8; --border:#334155; --danger:#ef4444; }
    *{box-sizing:border-box;margin:0;padding:0}
    body{font-family:'Poppins',sans-serif;background:var(--background);color:var(--text)}
    .dashboard{display:flex;min-height:100vh}
    .sidebar{width:260px;background:var(--sidebar);padding:1.5rem;border-right:1px solid var(--border)}
    .sidebar a{color:var(--muted);text-decoration:none;display:flex;align-items:center;padding:.75rem 1rem;border-radius:8px;margin-bottom:.25rem}
    .sidebar a:hover{background-color:rgba(0,217,255,.1);color:#a7f3ff}
    .main{flex:1;padding:2rem}
    .card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:1.5rem;max-width:900px;margin:0 auto}
    .grid{display:grid;grid-template-columns:1fr auto;gap:.75rem;align-items:center}
    .row{display:flex;gap:.75rem;align-items:center;margin:.75rem 0}
    input{background:#131c31;border:1px solid var(--border);border-radius:8px;padding:.75rem 1rem;color:var(--text)}
    button{background:var(--danger);border:none;color:#fff;padding:.8rem 1.2rem;border-radius:8px;font-weight:600;cursor:pointer}
    button.secondary{background:var(--primary-color);color:#0f172a}
    table{width:100%;border-collapse:collapse;margin-top:1rem}
    th,td{padding:.75rem 1rem;border-bottom:1px solid var(--border)}
    thead{background:#2a3a54}
    .toast{position:fixed;top:20px;right:20px;background:#fff;color:#333;padding:12px 16px;border-left:5px solid;border-radius:8px;box-shadow:0 5px 15px rgba(0,0,0,.2)}
    .toast.error{border-color:var(--danger)}
    .toast.success{border-color:#22c55e}
  </style>
  <script>
    function showToast(msg,type='success'){const t=document.createElement('div');t.className=`toast ${type}`;t.textContent=msg;document.body.appendChild(t);setTimeout(()=>t.remove(),4000)}
  </script>
</head>
<body>
  <div class="dashboard">
    <nav class="sidebar">
      <div style="display:flex;align-items:center;gap:1rem;margin-bottom:2rem">
        <i class="fas fa-brain" style="font-size:2rem;color:var(--primary-color)"></i>
        <h1 style="font-size:1.3rem;color:#fff">LMS Admin</h1>
      </div>
      <div>
        <a href="{{ url_for('admin.hr_agent_page') }}"><i class="fas fa-users" style="margin-right:.75rem"></i> Employees</a>
        <a href="{{ url_for('admin.courses_page') }}"><i class="fas fa-book" style="margin-right:.75rem"></i> Courses</a>
      </div>
    </nav>
    <main class="main">
      <div class="card">
        <h2 style="margin-bottom:1rem">Delete Employee</h2>
        <div class="row">
          <input id="searchInput" type="text" placeholder="Search by ID or Name..." oninput="filterList()" />
          <button class="secondary" onclick="refreshList()"><i class="fas fa-rotate"></i> Refresh</button>
        </div>
        <div class="row">
          <input id="empIdInput" type="number" placeholder="Delete by Employee ID (e.g., 101)" />
          <button onclick="deleteById()"><i class="fas fa-user-minus"></i> Delete</button>
        </div>
        <table>
          <thead><tr><th>ID</th><th>Name</th><th>Domain</th><th>Action</th></tr></thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </main>
  </div>
  <script>
    let allEmployees = [];

    async function refreshList(){
      const tbody=document.getElementById('tbody');
      tbody.innerHTML='<tr><td colspan="4">Loading...</td></tr>'
      try{
        const res=await fetch('/admin/list_employees',{credentials:'include'});
        const data=await res.json();
        tbody.innerHTML='';
        allEmployees = (data.success && Array.isArray(data.employees)) ? data.employees : [];
        renderRows(allEmployees);
      }catch(e){
        tbody.innerHTML='<tr><td colspan="4">Failed to load employees.</td></tr>'
      }
    }

    function renderRows(list){
      const tbody=document.getElementById('tbody');
      tbody.innerHTML='';
      if(!list || list.length===0){
        tbody.innerHTML='<tr><td colspan="4">No employees found.</td></tr>'
        return;
      }
      list.forEach(emp=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${emp.id}</td><td>${emp.NAME||'N/A'}</td><td>${emp.domain||'N/A'}</td><td><button onclick="deleteById(${emp.id})">Delete</button></td>`;
        tbody.appendChild(tr);
      });
    }

    function filterList(){
      const q=(document.getElementById('searchInput').value||'').trim().toLowerCase();
      if(!q){ renderRows(allEmployees); return; }
      const filtered = allEmployees.filter(emp=>{
        const idMatch = String(emp.id).includes(q);
        const nameMatch = (emp.NAME||'').toLowerCase().includes(q);
        return idMatch || nameMatch;
      });
      renderRows(filtered);
    }

    async function deleteById(id){
      const input=document.getElementById('empIdInput');
      const empId = id || parseInt(input.value,10);
      if(!empId){ showToast('Please enter a valid employee ID','error'); return }
      if(!confirm('Are you sure you want to delete this employee?')) return;
      try{
        const res=await fetch('/admin/delete_employee',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify({emp_id:empId})});
        const data=await res.json();
        if(data.success){ showToast(data.message,'success'); refreshList(); }
        else{ showToast(data.error||'Failed to delete','error'); }
      }catch(e){ showToast('Request failed','error'); }
    }

    window.addEventListener('DOMContentLoaded',refreshList)
  </script>
</body>
</html>